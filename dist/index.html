<style scoped>
.html-widget {
  border: 1px solid #ececec;
  background-color: #ececec;
}

.html-widget .credit {
  padding: 5px 5px 0;
  margin-bottom: 0;
}

.html-widget .caption {
  padding: 5px 5px 4px;
  margin-bottom: 10px;
}

.outerwrapper {
  width: 100%;
  position: relative;
  background-color: #fff;
}
.outerwrapper h2 {
  margin: 0 10px 0 10px;
  padding: 10px 0 0 0;
}
.outerwrapper p {
  margin: 10px;
  padding: 0;
}
.outerwrapper input {
  width: 90%;
  margin: 0 5%;
}
.outerwrapper .widget-images ul {
  padding-left: 0;
}
.outerwrapper .widget-images li {
  list-style: none;
}
.outerwrapper .widget-selector {
  padding: 0 3%;
  position: relative;
  height: 0;
}
.outerwrapper .widget-canvas {
  position: relative;
  margin: 0 5%;
}
.outerwrapper input[type=range] {
  -webkit-appearance: none;
  margin: 0;
  width: 100%;
  background: none;
}
.outerwrapper input[type=range]:focus {
  outline: none;
}
.outerwrapper input[type=range]::-moz-focus-outer {
  border: 0;
}
.outerwrapper input[type=range]::-webkit-slider-runnable-track {
  background: transparent;
}
.outerwrapper input[type=range]::-webkit-slider-thumb {
  border: 4px solid #fff;
  height: 25px;
  width: 25px;
  border-radius: 50%;
  background: #333;
  cursor: pointer;
  -webkit-appearance: none;
  margin-top: -7.6px;
  transition: border-color 200ms;
}
.outerwrapper input[type=range]:focus::-webkit-slider-thumb {
  border-color: skyblue;
}
.outerwrapper input[type=range]::-moz-range-track {
  background: transparent;
}
.outerwrapper input[type=range]::-moz-range-thumb {
  border: 4px solid #fff;
  height: 20px;
  width: 20px;
  border-radius: 50%;
  background: #333;
  cursor: pointer;
  transition: border-color 200ms;
}
.outerwrapper input[type=range]:focus::-moz-range-thumb {
  border-color: skyblue;
}
.outerwrapper input[type=range]::-ms-track {
  width: 100%;
  height: 8px;
  background: transparent;
  border-color: transparent;
  border-width: 20px 0;
  color: transparent;
}
.outerwrapper input[type=range]::-ms-fill-lower {
  background: transparent;
}
.outerwrapper input[type=range]::-ms-fill-upper {
  background: transparent;
}
.outerwrapper input[type=range]::-ms-thumb {
  border: 4px solid #fff;
  height: 20px;
  width: 20px;
  border-radius: 50%;
  background: #333;
  transition: border-color 200ms;
}
.outerwrapper input[type=range]:focus::-ms-thumb {
  border-color: skyblue;
}

</style>
<!--[if gt IE 8]><!-->
<style>
.js-enabled .widget-images {
	display: none;
}
</style>
<!--<![endif]-->
<div class="outerwrapper">
	<h2>Image slider</h2>
	<p>Greenland before and after.</p>
	<div class="widget-canvas"></div>
	<div class="widget-selector"></div>
	<div class="widget-images">
	<ul>
		<li>
			<img src="http://www.nature.com/polopoly_fs/7.37796.1468426670!/image/montage-1-a.jpg" alt="before"/>
			<p>Before</p>
		</li>
		<li>
			<img src="https://poly-admin1.nature.com/polopoly/polopoly_fs/7.37797.1468426722!/image/montage-1-b.jpg" alt="after" />
			<p>After</p>
		</li>
	</ul>
		
	</div>
</div>

<p class="credit">Source:</p>

<!--[if gt IE 8]><!-->
<script type="text/javascript">
(function() {
	var init = function($) {
		var allImages = [];

		/* Store with window Width to stop iOS resizing on scroll */
		var windowWidth = $(window).width();
		
		var width = $("#content").width() * 0.9;
		var height = Math.floor(width * 0.62);

		var range;
		var select;
		var startingValue = 0.5;

		var outerWrapper = $(".outerwrapper");
		outerWrapper.find(".widget-selector").css("top", height * -1);

		var imageCanvas = $("<canvas></canvas>");
		var rangeInput = $("<input />");

		imageCanvas.attr({
			"width": width,
			"height": height
		});

		outerWrapper.find(".widget-canvas")
			.append(imageCanvas);

		var ctx = imageCanvas[0].getContext("2d");
		ctx.strokeStyle = "#ffffff";
		ctx.lineWidth = 2;
		
		var testInput = document.createElement("input");
		testInput.setAttribute("type", "range");

		var widgetImages = outerWrapper.select(".widget-images");
		
		/*	Select each of the images and push a new img object into
			the allImages array with the relevant src */
		var images = widgetImages.find("img");

		$.each(images, function (key, value) {
			var thisImage = new Image();
			thisImage.src = this.src;
			allImages.push(thisImage);
		});

		/*	drawFrame() num = value of input
			redraw the canvas */
		function drawFrame (num) {
			ctx.clearRect(0,0,width,height);

			ctx.fillStyle = "rgb(200,0,0)";
	        ctx.fillRect (0, 0, width, height);
			
			/* Check that num is greater than 0 so we're not multiplying width by 0 */
			if (num > 0) {
				ctx.drawImage(allImages[0], 0, 0, (width * num), height, 0, 0, (width * num), height);
				ctx.drawImage(allImages[1], (width * num), 0, (width * (1 - num)), height, (width * num), 0, (width * (1 - num)), height);
			} else {
				ctx.drawImage(allImages[1], 0, 0, width, height, 0, 0, width, height);
			}
			
			ctx.beginPath();
			ctx.moveTo((width * num),0);
			ctx.lineTo((width * num),height);
			ctx.closePath();
			ctx.stroke();
		}

		/*	makeRange()
			Append an input[type="range"] and call drawFrame on change */
		function makeRange () {
			
			rangeInput.attr({
				"type" : "range",
				"min" : 0,
				"max" : images.length - 1,
				"step" : "any",
				"value" : startingValue
			}).css("height",height);

			range = outerWrapper.find(".widget-selector");
			range.append(rangeInput);
			
			rangeInput.bind("input", function() {
				drawFrame(parseFloat(this.value));
			});
		}

		/*	makeSelect()
			Append a select element and call drawFrame on change */
		function makeSelect () {
			console.log("Let's call the whole thing off");
		}

		/*	resize()
			Redraw and resize the canvas */
		function resize () {
			if($(window).width() != windowWidth){
				
				windowWidth = $(window).width();
				width = $("#content").width() * 0.9;
				height = Math.floor(width * 0.62);

				imageCanvas.attr({
					"width": width,
					"height": height
				});

				ctx.strokeStyle = "#ffffff";
				ctx.lineWidth = 2;

				rangeInput.attr({"value": startingValue});
				drawFrame(startingValue);
			}
		}

		/* Fill the canvas image with frame 0 as soon as it is ready */
		allImages[0].onload = function() {
			drawFrame(startingValue);
		};

		allImages[1].onload = function() {
			drawFrame(startingValue);
		};

		/*	call makeRange() if input[type="range"] is suported
			call makeSelect() otherwise */
		if (testInput.type !== "text") {
			makeRange();
		} else {
			makeSelect();
		}

		window.onresize = resize;

	};

	/*	Before calling init()
		- check jQuery is loaded
		- check the images are hidden */
	setTimeout(function() {
		if (typeof jQuery !== 'undefined') {
			if (jQuery(".widget-images").css("display") !== "none") {
				jQuery(".widget-images").css("display","none");
			}
			init(jQuery);
		} else {
			setTimeout(arguments.callee, 60);
		}
	}, 60);

})();
</script>
<!--<![endif]-->